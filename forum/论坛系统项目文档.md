# 码韵智汇栈 - 技术论坛系统项目文档

## 一、项目概述

### 1.1 项目简介

码韵智汇栈是一个功能完善的技术论坛系统，采用前后端分离架构，基于 Spring Boot 框架开发。系统为开发者提供了一个技术交流、知识分享、经验讨论的综合性平台。

项目的核心特色包括：
- 完整的用户体系（注册、登录、个人中心）
- 丰富的帖子功能（发布、编辑、回复、点赞）
- 多维度搜索（关键字搜索、高级搜索）
- AI 智能助手（基于火山引擎豆包大模型）
- 站内私信系统
- 游客浏览模式

### 1.2 技术选型

#### 后端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Java | 1.8 | 开发语言 |
| Spring Boot | 2.7.6 | 核心框架 |
| MyBatis | 2.3.0 | ORM 框架 |
| MySQL | 5.1.49 | 数据库 |
| Druid | 1.2.16 | 数据库连接池 |
| Swagger | 3.0.0 | API 文档生成 |
| OkHttp | 4.9.3 | HTTP 客户端（AI接口调用） |
| FastJSON | 1.2.83 | JSON 处理 |
| Lombok | - | 简化代码 |

#### 前端技术栈
| 技术 | 说明 |
|------|------|
| HTML5 + CSS3 | 页面结构与样式 |
| JavaScript | 交互逻辑 |
| jQuery | DOM 操作与 AJAX |
| Bootstrap 5 | UI 组件库 |
| Tabler UI | 管理界面组件 |
| Editor.md | Markdown 编辑器 |
| jQuery Toast | 消息提示组件 |

### 1.3 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                        前端层                                │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 首页    │ │ 帖子页  │ │ 个人中心│ │ 登录注册│           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
└─────────────────────────────────────────────────────────────┘
                              │ HTTP/AJAX
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Spring Boot 应用                        │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   Controller 层                      │   │
│  │  UserController │ ArticleController │ AIController  │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    Service 层                        │   │
│  │  UserService │ ArticleService │ AIService │ ...     │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                     DAO 层                           │   │
│  │  UserMapper │ ArticleMapper │ BoardMapper │ ...     │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │ MyBatis
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      MySQL 数据库                            │
│  t_user │ t_article │ t_board │ t_article_reply │ t_message│
└─────────────────────────────────────────────────────────────┘
```

---

## 二、功能模块详解

### 2.1 用户模块

#### 2.1.1 用户注册
- **功能描述**：新用户通过填写用户名、密码、昵称等信息完成注册
- **接口地址**：`POST /user/register`
- **请求参数**：
  ```json
  {
    "username": "用户名（唯一，4-20字符）",
    "password": "密码（6-20字符）",
    "nickname": "昵称（2-20字符）"
  }
  ```
- **密码加密**：采用 MD5 + Salt 双重加密
  - 生成随机 Salt 值
  - 密码 = MD5(MD5(原始密码) + Salt)
- **业务逻辑**：
  1. 校验用户名是否已存在
  2. 生成随机 Salt
  3. 对密码进行加密处理
  4. 创建用户记录

#### 2.1.2 用户登录
- **功能描述**：用户通过用户名和密码登录系统
- **接口地址**：`POST /user/login`
- **登录流程**：
  1. 根据用户名查询用户信息
  2. 获取用户的 Salt 值
  3. 对输入密码进行同样的加密处理
  4. 比对加密后的密码
  5. 登录成功后将用户信息存入 Session
- **Session 管理**：
  - 登录成功后存储 `USER_SESSION` 到 HttpSession
  - 前端通过 `/user/info` 接口获取当前登录用户信息

#### 2.1.3 游客模式
- **功能描述**：未登录用户可以浏览帖子，但无法发帖、回复、点赞
- **实现方式**：
  - 前端通过 `currentUserId` 变量判断登录状态
  - 游客点击需要登录的功能时，弹出提示"请先登录"
  - 页脚的"个人中心"、"我的帖子"链接对游客进行权限检查

#### 2.1.4 个人信息管理
- **功能描述**：用户可修改头像、昵称、性别、个人简介等信息
- **接口地址**：`POST /user/modifyInfo`
- **头像上传**：
  - 支持 JPG、PNG、JPEG 格式
  - 上传后存储到 `/static/upload/avatar/` 目录
  - 文件名使用 UUID 生成，避免重复

#### 2.1.5 密码修改
- **功能描述**：用户修改登录密码
- **接口地址**：`POST /user/modifyPwd`
- **安全校验**：
  - 需要输入原密码进行验证
  - 新密码需要二次确认

### 2.2 帖子模块

#### 2.2.1 发布帖子
- **功能描述**：登录用户可以发布新帖子
- **接口地址**：`POST /article/create`
- **请求参数**：
  ```json
  {
    "boardId": "板块ID",
    "title": "帖子标题（5-100字符）",
    "content": "帖子内容（Markdown格式）"
  }
  ```
- **编辑器**：使用 Editor.md 支持 Markdown 语法
- **事务处理**：
  1. 创建帖子记录
  2. 更新板块的帖子数量 +1
  3. 更新用户的发帖数量 +1

#### 2.2.2 帖子详情
- **功能描述**：查看帖子的完整内容、作者信息、回复列表
- **接口地址**：`GET /article/details?id={articleId}`
- **返回数据**：
  - 帖子基本信息（标题、内容、发布时间）
  - 作者信息（昵称、头像、发帖数）
  - 统计数据（浏览量、点赞数、回复数）
  - 回复列表
- **浏览量统计**：每次访问详情页，浏览量 +1
- **浏览记录**：登录用户访问帖子时，自动记录到本地 localStorage

#### 2.2.3 编辑帖子
- **功能描述**：作者可以编辑自己发布的帖子
- **接口地址**：`POST /article/modify`
- **权限控制**：只有帖子作者才能编辑

#### 2.2.4 删除帖子
- **功能描述**：作者或管理员可以删除帖子
- **接口地址**：`POST /article/delete?id={articleId}`
- **删除方式**：逻辑删除（设置 deleteState = 1）
- **事务处理**：
  1. 更新帖子删除状态
  2. 更新板块的帖子数量 -1
  3. 更新用户的发帖数量 -1

#### 2.2.5 点赞功能
- **功能描述**：登录用户可以为帖子点赞
- **接口地址**：`POST /article/thumbsUp?id={articleId}`
- **附加功能**：点赞后自动将帖子添加到"我的收藏"（存储在 localStorage）

#### 2.2.6 帖子回复
- **功能描述**：登录用户可以对帖子发表回复
- **接口地址**：`POST /reply/create`
- **请求参数**：
  ```json
  {
    "articleId": "帖子ID",
    "content": "回复内容（Markdown格式）"
  }
  ```
- **回复编辑器**：使用 Editor.md，支持 Markdown 语法

### 2.3 板块模块

#### 2.3.1 板块列表
- **功能描述**：获取论坛所有板块
- **接口地址**：`GET /board/topList`
- **默认板块**：
  - Java
  - C++
  - 前端技术
  - MySQL
  - 面试宝典
  - 经验分享
  - 招聘信息
  - 福利待遇
  - 灌水区

#### 2.3.2 按板块筛选
- **功能描述**：点击板块名称，筛选该板块下的所有帖子
- **接口地址**：`GET /article/getAllByBoardId?boardId={boardId}`

### 2.4 搜索模块

#### 2.4.1 快速搜索
- **功能描述**：通过关键字搜索帖子标题和内容
- **接口地址**：`GET /article/search?keyword={keyword}`
- **搜索范围**：帖子标题、帖子内容
- **UI 设计**：GitHub 风格的搜索弹窗
  - 点击顶部搜索框弹出大搜索弹窗
  - 紫色渐变背景
  - 热门搜索标签
  - 支持回车搜索

#### 2.4.2 高级搜索
- **功能描述**：多条件组合搜索
- **接口地址**：`GET /article/advancedSearch`
- **搜索条件**：
  | 参数 | 说明 |
  |------|------|
  | title | 标题关键字 |
  | content | 内容关键字 |
  | author | 作者昵称 |
  | boardId | 板块ID |
  | startDate | 开始日期 |
  | endDate | 结束日期 |
  | searchType | 搜索类型（all/title/content） |

### 2.5 站内信模块

#### 2.5.1 发送私信
- **功能描述**：用户之间可以发送私信
- **接口地址**：`POST /message/send`
- **请求参数**：
  ```json
  {
    "receiveUserId": "接收者用户ID",
    "content": "私信内容"
  }
  ```
- **入口**：在帖子详情页点击作者卡片的"发私信"按钮

#### 2.5.2 私信列表
- **功能描述**：查看收到的所有私信
- **接口地址**：`GET /message/getList`
- **状态管理**：
  - 未读状态（state = 0）
  - 已读状态（state = 1）

#### 2.5.3 未读消息提醒
- **功能描述**：顶部导航栏显示未读私信数量
- **接口地址**：`GET /message/getUnreadCount`
- **显示方式**：红色小圆点 + 数字角标

### 2.6 AI 智能助手模块

#### 2.6.1 功能概述
系统集成了火山引擎的豆包大模型，提供两个 AI 功能：
- **AI 回答**：根据帖子内容生成智能回复
- **AI 摘要**：对长文章生成内容摘要

#### 2.6.2 AI 回答
- **功能描述**：AI 根据帖子标题和内容，生成专业的技术回复
- **接口地址**：`GET /ai/generateReply?articleId={articleId}`
- **提示词模板**：
  ```
  你是一个技术论坛的AI助手。请根据以下帖子内容，给出一个专业、友好的回复。
  帖子标题：{title}
  帖子内容：{content}
  请给出你的回复（不超过500字）：
  ```

#### 2.6.3 AI 摘要
- **功能描述**：AI 对帖子内容进行摘要总结
- **接口地址**：`GET /ai/generateSummary?articleId={articleId}`
- **提示词模板**：
  ```
  请对以下文章内容进行摘要总结，提取关键信息，不超过200字：
  {content}
  ```

#### 2.6.4 AI 配置
```yaml
ai:
  enabled: true                    # 是否启用AI功能
  api-key: your-api-key           # 火山引擎API Key
  api-url: https://ark.cn-beijing.volces.com/api/v3/chat/completions
```

#### 2.6.5 技术实现
- **HTTP 客户端**：OkHttp
- **超时设置**：
  - 连接超时：30秒
  - 读取超时：60秒
  - 写入超时：30秒
- **请求格式**：兼容 OpenAI API 格式

### 2.7 个人中心模块

#### 2.7.1 我的帖子
- **功能描述**：查看当前用户发布的所有帖子
- **接口地址**：`GET /article/getByUserId`

#### 2.7.2 我的收藏
- **功能描述**：查看点赞过的帖子列表
- **存储方式**：localStorage
- **存储键名**：`forum_favorites_{userId}`
- **数据结构**：
  ```json
  [
    {
      "id": "帖子ID",
      "title": "帖子标题",
      "author": "作者昵称",
      "time": "收藏时间"
    }
  ]
  ```
- **容量限制**：最多保存 50 条记录

#### 2.7.3 浏览记录
- **功能描述**：查看浏览过的帖子列表
- **存储方式**：localStorage
- **存储键名**：`forum_history_{userId}`
- **自动记录**：访问帖子详情页时自动添加
- **容量限制**：最多保存 100 条记录

### 2.8 管理员功能

#### 2.8.1 用户管理
- **禁言用户**：`POST /user/setState`
- **解禁用户**：设置 state = 0

#### 2.8.2 板块管理
- **新增板块**：`POST /board/create`
- **删除板块**：`POST /board/delete`（逻辑删除）

---

## 三、项目结构详解

```
forum/
├── src/
│   ├── main/
│   │   ├── java/com/example/forum/
│   │   │   ├── common/                      # 通用类
│   │   │   │   ├── AppResult.java          # 统一响应结果封装
│   │   │   │   └── ResultCode.java         # 响应状态码枚举
│   │   │   │
│   │   │   ├── config/                      # 配置类
│   │   │   │   ├── AIConfig.java           # AI服务配置
│   │   │   │   ├── AppConfig.java          # 应用配置（Session键名等）
│   │   │   │   ├── MybatisConfig.java      # MyBatis配置
│   │   │   │   └── SwaggerConfig.java      # Swagger API文档配置
│   │   │   │
│   │   │   ├── controller/                  # 控制器层
│   │   │   │   ├── AIController.java       # AI功能接口
│   │   │   │   ├── ArticleController.java  # 帖子相关接口
│   │   │   │   ├── ArticleReplyController.java  # 回复相关接口
│   │   │   │   ├── BoardController.java    # 板块相关接口
│   │   │   │   ├── MessageController.java  # 站内信接口
│   │   │   │   ├── UserController.java     # 用户相关接口
│   │   │   │   └── TestController.java     # 测试接口
│   │   │   │
│   │   │   ├── dao/                         # 数据访问层
│   │   │   │   ├── ArticleMapper.java      # 帖子Mapper接口
│   │   │   │   ├── ArticleReplyMapper.java # 回复Mapper接口
│   │   │   │   ├── BoardMapper.java        # 板块Mapper接口
│   │   │   │   ├── MessageMapper.java      # 站内信Mapper接口
│   │   │   │   └── UserMapper.java         # 用户Mapper接口
│   │   │   │
│   │   │   ├── exception/                   # 异常处理
│   │   │   │   ├── ApplicationException.java    # 自定义业务异常
│   │   │   │   └── GlobalExceptionHandler.java  # 全局异常处理器
│   │   │   │
│   │   │   ├── interceptor/                 # 拦截器
│   │   │   │   ├── AppInterceptorConfigurer.java  # 拦截器配置
│   │   │   │   └── LoginInterceptor.java   # 登录拦截器
│   │   │   │
│   │   │   ├── model/                       # 实体类
│   │   │   │   ├── Article.java            # 帖子实体
│   │   │   │   ├── ArticleReply.java       # 回复实体
│   │   │   │   ├── Board.java              # 板块实体
│   │   │   │   ├── Message.java            # 站内信实体
│   │   │   │   └── User.java               # 用户实体
│   │   │   │
│   │   │   ├── services/                    # 服务层
│   │   │   │   ├── IAIService.java         # AI服务接口
│   │   │   │   ├── IArticleService.java    # 帖子服务接口
│   │   │   │   ├── IArticleReplyService.java  # 回复服务接口
│   │   │   │   ├── IBoardService.java      # 板块服务接口
│   │   │   │   ├── IMessageService.java    # 站内信服务接口
│   │   │   │   ├── IUserService.java       # 用户服务接口
│   │   │   │   └── impl/                   # 服务实现类
│   │   │   │       ├── AIServiceImpl.java
│   │   │   │       ├── ArticleServiceImpl.java
│   │   │   │       ├── ArticleReplyServiceImpl.java
│   │   │   │       ├── BoardServiceImpl.java
│   │   │   │       ├── MessageServiceImpl.java
│   │   │   │       └── UserServiceImpl.java
│   │   │   │
│   │   │   ├── utils/                       # 工具类
│   │   │   │   ├── MD5Util.java            # MD5加密工具
│   │   │   │   ├── StringUtil.java         # 字符串工具
│   │   │   │   └── UUIDUtil.java           # UUID生成工具
│   │   │   │
│   │   │   └── ForumApplication.java        # 启动类
│   │   │
│   │   └── resources/
│   │       ├── mapper/                      # MyBatis映射文件
│   │       │   ├── ArticleMapper.xml
│   │       │   ├── ArticleReplyMapper.xml
│   │       │   ├── BoardMapper.xml
│   │       │   ├── MessageMapper.xml
│   │       │   ├── UserMapper.xml
│   │       │   └── extension/              # 扩展映射文件
│   │       │       ├── ArticleExtMapper.xml
│   │       │       ├── ArticleReplyExtMapper.xml
│   │       │       ├── BoardExtMapper.xml
│   │       │       ├── MessageExtMapper.xml
│   │       │       └── UserExtMapper.xml
│   │       │
│   │       ├── static/                      # 静态资源
│   │       │   ├── index.html              # 首页
│   │       │   ├── sign-in.html            # 登录页
│   │       │   ├── sign-up.html            # 注册页
│   │       │   ├── details.html            # 帖子详情页
│   │       │   ├── article.html            # 发帖页
│   │       │   ├── article_edit.html       # 编辑帖子页
│   │       │   ├── article_list.html       # 帖子列表页
│   │       │   ├── profile.html            # 用户主页
│   │       │   ├── settings.html           # 个人设置页
│   │       │   ├── dist/                   # 第三方库
│   │       │   ├── image/                  # 图片资源
│   │       │   ├── js/common.js            # 公共JS
│   │       │   └── upload/avatar/          # 用户头像上传目录
│   │       │
│   │       ├── application.yml             # 主配置文件
│   │       ├── application-dev.yml         # 开发环境配置
│   │       └── application-prod.yml        # 生产环境配置
│   │
│   └── test/                               # 测试代码
│       └── java/com/example/forum/
│           ├── ForumApplicationTests.java
│           └── services/impl/              # 服务层单元测试
│
├── pom.xml                                 # Maven配置文件
└── forum_db.sql                            # 数据库初始化脚本
```


---

## 四、数据库设计

### 4.1 数据库信息
- **数据库名**：forum_db
- **字符集**：utf8mb4
- **排序规则**：utf8mb4_general_ci

### 4.2 用户表 (t_user)

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | bigint | PRIMARY KEY, AUTO_INCREMENT | - | 用户ID |
| username | varchar(20) | NOT NULL, UNIQUE | - | 用户名 |
| password | varchar(32) | NOT NULL | - | 加密后的密码 |
| nickname | varchar(50) | NOT NULL | - | 昵称 |
| phoneNum | varchar(20) | - | NULL | 手机号 |
| email | varchar(50) | - | NULL | 电子邮箱 |
| gender | tinyint | NOT NULL | 2 | 性别：0女/1男/2保密 |
| salt | varchar(32) | NOT NULL | - | 密码盐值 |
| avatarUrl | varchar(255) | - | NULL | 头像路径 |
| articleCount | int | NOT NULL | 0 | 发帖数量 |
| isAdmin | tinyint | NOT NULL | 0 | 是否管理员：0否/1是 |
| remark | varchar(1000) | - | NULL | 个人简介 |
| state | tinyint | NOT NULL | 0 | 状态：0正常/1禁言 |
| deleteState | tinyint | NOT NULL | 0 | 删除标记：0否/1是 |
| createTime | datetime | NOT NULL | - | 创建时间 |
| updateTime | datetime | NOT NULL | - | 更新时间 |

### 4.3 板块表 (t_board)

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | bigint | PRIMARY KEY, AUTO_INCREMENT | - | 板块ID |
| name | varchar(50) | NOT NULL | - | 板块名称 |
| articleCount | int | NOT NULL | 0 | 帖子数量 |
| sort | int | NOT NULL | 0 | 排序优先级（升序） |
| state | tinyint | NOT NULL | 0 | 状态：0正常/1禁用 |
| deleteState | tinyint | NOT NULL | 0 | 删除标记 |
| createTime | datetime | NOT NULL | - | 创建时间 |
| updateTime | datetime | NOT NULL | - | 更新时间 |

### 4.4 帖子表 (t_article)

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | bigint | PRIMARY KEY, AUTO_INCREMENT | - | 帖子ID |
| boardId | bigint | NOT NULL | - | 所属板块ID |
| userId | bigint | NOT NULL | - | 发帖用户ID |
| title | varchar(100) | NOT NULL | - | 帖子标题 |
| content | text | NOT NULL | - | 帖子内容（Markdown） |
| visitCount | int | NOT NULL | 0 | 浏览量 |
| replyCount | int | NOT NULL | 0 | 回复数 |
| likeCount | int | NOT NULL | 0 | 点赞数 |
| state | tinyint | NOT NULL | 0 | 状态：0正常/1禁用 |
| deleteState | tinyint | NOT NULL | 0 | 删除标记 |
| createTime | datetime | NOT NULL | - | 创建时间 |
| updateTime | datetime | NOT NULL | - | 更新时间 |

### 4.5 回复表 (t_article_reply)

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | bigint | PRIMARY KEY, AUTO_INCREMENT | - | 回复ID |
| articleId | bigint | NOT NULL | - | 所属帖子ID |
| postUserId | bigint | NOT NULL | - | 回复用户ID |
| replyId | bigint | - | NULL | 回复的回复ID（楼中楼） |
| replyUserId | bigint | - | NULL | 被回复用户ID |
| content | varchar(500) | NOT NULL | - | 回复内容 |
| likeCount | int | NOT NULL | 0 | 点赞数 |
| state | tinyint | NOT NULL | 0 | 状态 |
| deleteState | tinyint | NOT NULL | 0 | 删除标记 |
| createTime | datetime | NOT NULL | - | 创建时间 |
| updateTime | datetime | NOT NULL | - | 更新时间 |

### 4.6 站内信表 (t_message)

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | bigint | PRIMARY KEY, AUTO_INCREMENT | - | 消息ID |
| postUserId | bigint | NOT NULL | - | 发送者ID |
| receiveUserId | bigint | NOT NULL | - | 接收者ID |
| content | varchar(255) | NOT NULL | - | 消息内容 |
| state | tinyint | NOT NULL | 0 | 状态：0未读/1已读 |
| deleteState | tinyint | NOT NULL | 0 | 删除标记 |
| createTime | datetime | NOT NULL | - | 创建时间 |
| updateTime | datetime | NOT NULL | - | 更新时间 |

### 4.7 ER 图

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│   t_user    │       │  t_article  │       │   t_board   │
├─────────────┤       ├─────────────┤       ├─────────────┤
│ id (PK)     │◄──┐   │ id (PK)     │   ┌──►│ id (PK)     │
│ username    │   │   │ boardId (FK)│───┘   │ name        │
│ password    │   │   │ userId (FK) │───┐   │ articleCount│
│ nickname    │   │   │ title       │   │   │ sort        │
│ ...         │   │   │ content     │   │   │ ...         │
└─────────────┘   │   │ ...         │   │   └─────────────┘
                  │   └─────────────┘   │
                  │          │          │
                  │          ▼          │
                  │   ┌─────────────┐   │
                  │   │t_article_reply│ │
                  │   ├─────────────┤   │
                  │   │ id (PK)     │   │
                  │   │ articleId   │───┘
                  │   │ postUserId  │───┐
                  │   │ content     │   │
                  │   │ ...         │   │
                  │   └─────────────┘   │
                  │                     │
                  │   ┌─────────────┐   │
                  │   │  t_message  │   │
                  │   ├─────────────┤   │
                  │   │ id (PK)     │   │
                  └───│ postUserId  │   │
                  └───│receiveUserId│───┘
                      │ content     │
                      │ ...         │
                      └─────────────┘
```

---

## 五、配置文件详解

### 5.1 主配置文件 (application.yml)

```yaml
spring:
  profiles:
    active: dev    # 激活的配置文件：dev/prod
```

### 5.2 开发环境配置 (application-dev.yml)

```yaml
# AI助手配置
ai:
  enabled: true                              # 是否启用AI功能
  api-key: your-api-key                      # 火山引擎API Key
  api-url: https://ark.cn-beijing.volces.com/api/v3/chat/completions

spring:
  application:
    name: 论坛系统                            # 项目名称
  
  # 静态资源配置
  web:
    resources:
      static-locations: classpath:/static/, file:src/main/resources/static/
  
  # 控制台输出配置
  output:
    ansi:
      enabled: ALWAYS
  
  # 数据源配置
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/forum_db?characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
    driver-class-name: com.mysql.jdbc.Driver
  
  # MVC配置
  mvc:
    pathmatch:
      matching-strategy: ANT_PATH_MATCHER    # Swagger兼容性配置
  
  # JSON序列化配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss         # 日期格式
    time-zone: Asia/Shanghai                 # 时区
    default-property-inclusion: NON_NULL     # 不序列化null值

# 服务器配置
server:
  port: 9090                                 # 服务端口

# 日志配置
logging:
  pattern:
    dateformat: yyyy-MM-dd HH:mm:ss
  level:
    root: info
  file:
    path: /log/forum_001                     # 日志保存路径

# MyBatis配置
mybatis:
  mapper-locations: classpath:mapper/**/*.xml

# 项目自定义配置
bit-forum:
  login:
    url: sign-in.html                        # 未登录跳转页面
  index:
    board-num: 20                            # 首页显示板块数量
```

### 5.3 生产环境配置 (application-prod.yml)

与开发环境的主要区别：
```yaml
spring:
  datasource:
    password: BITE@yyds.666                  # 生产环境数据库密码
```


---

## 六、API 接口文档

### 6.1 用户接口 (UserController)

#### 6.1.1 用户注册
- **URL**：`POST /user/register`
- **Content-Type**：`application/x-www-form-urlencoded`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | String | 是 | 用户名（4-20字符） |
| password | String | 是 | 密码（6-20字符） |
| nickname | String | 是 | 昵称（2-20字符） |

- **响应示例**：
```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

#### 6.1.2 用户登录
- **URL**：`POST /user/login`
- **Content-Type**：`application/x-www-form-urlencoded`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | String | 是 | 用户名 |
| password | String | 是 | 密码 |

- **响应示例**：
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": 1,
    "username": "admin",
    "nickname": "管理员",
    "avatarUrl": "/upload/avatar/xxx.jpg",
    "isAdmin": 1
  }
}
```

#### 6.1.3 获取用户信息
- **URL**：`GET /user/info`
- **说明**：获取当前登录用户信息
- **响应示例**：
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": 1,
    "username": "admin",
    "nickname": "管理员",
    "gender": 1,
    "avatarUrl": "/upload/avatar/xxx.jpg",
    "articleCount": 10,
    "isAdmin": 1,
    "remark": "个人简介"
  }
}
```

#### 6.1.4 退出登录
- **URL**：`GET /user/logout`
- **说明**：清除Session，退出登录

#### 6.1.5 修改个人信息
- **URL**：`POST /user/modifyInfo`
- **Content-Type**：`application/x-www-form-urlencoded`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| nickname | String | 否 | 昵称 |
| gender | Integer | 否 | 性别 |
| email | String | 否 | 邮箱 |
| phoneNum | String | 否 | 手机号 |
| remark | String | 否 | 个人简介 |

#### 6.1.6 修改密码
- **URL**：`POST /user/modifyPwd`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| oldPassword | String | 是 | 原密码 |
| newPassword | String | 是 | 新密码 |

### 6.2 帖子接口 (ArticleController)

#### 6.2.1 发布帖子
- **URL**：`POST /article/create`
- **Content-Type**：`application/x-www-form-urlencoded`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| boardId | Long | 是 | 板块ID |
| title | String | 是 | 标题（5-100字符） |
| content | String | 是 | 内容（Markdown） |

#### 6.2.2 获取帖子列表
- **URL**：`GET /article/getAllByBoardId`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| boardId | Long | 否 | 板块ID（不传则获取全部） |

- **响应示例**：
```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {
      "id": 1,
      "title": "帖子标题",
      "visitCount": 100,
      "replyCount": 10,
      "likeCount": 5,
      "createTime": "2026-01-27 10:00:00",
      "user": {
        "id": 1,
        "nickname": "作者昵称",
        "avatarUrl": "/upload/avatar/xxx.jpg"
      }
    }
  ]
}
```

#### 6.2.3 获取帖子详情
- **URL**：`GET /article/details`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 帖子ID |

- **响应示例**：
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": 1,
    "boardId": 1,
    "title": "帖子标题",
    "content": "帖子内容（Markdown）",
    "visitCount": 100,
    "replyCount": 10,
    "likeCount": 5,
    "createTime": "2026-01-27 10:00:00",
    "own": true,
    "user": {
      "id": 1,
      "nickname": "作者昵称",
      "avatarUrl": "/upload/avatar/xxx.jpg",
      "articleCount": 10
    }
  }
}
```

#### 6.2.4 编辑帖子
- **URL**：`POST /article/modify`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 帖子ID |
| title | String | 是 | 新标题 |
| content | String | 是 | 新内容 |

#### 6.2.5 删除帖子
- **URL**：`POST /article/delete`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 帖子ID |

#### 6.2.6 点赞帖子
- **URL**：`POST /article/thumbsUp`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 帖子ID |

#### 6.2.7 搜索帖子
- **URL**：`GET /article/search`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| keyword | String | 是 | 搜索关键字 |

#### 6.2.8 高级搜索
- **URL**：`GET /article/advancedSearch`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | String | 否 | 标题关键字 |
| content | String | 否 | 内容关键字 |
| author | String | 否 | 作者昵称 |
| boardId | Long | 否 | 板块ID |
| startDate | String | 否 | 开始日期（yyyy-MM-dd） |
| endDate | String | 否 | 结束日期（yyyy-MM-dd） |
| searchType | String | 否 | 搜索类型：all/title/content |

### 6.3 回复接口 (ArticleReplyController)

#### 6.3.1 发表回复
- **URL**：`POST /reply/create`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| articleId | Long | 是 | 帖子ID |
| content | String | 是 | 回复内容 |

#### 6.3.2 获取回复列表
- **URL**：`GET /reply/getReplies`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| articleId | Long | 是 | 帖子ID |

### 6.4 板块接口 (BoardController)

#### 6.4.1 获取板块列表
- **URL**：`GET /board/topList`
- **响应示例**：
```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {"id": 1, "name": "Java", "articleCount": 100},
    {"id": 2, "name": "C++", "articleCount": 50}
  ]
}
```

### 6.5 站内信接口 (MessageController)

#### 6.5.1 发送私信
- **URL**：`POST /message/send`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| receiveUserId | Long | 是 | 接收者ID |
| content | String | 是 | 消息内容 |

#### 6.5.2 获取私信列表
- **URL**：`GET /message/getList`

#### 6.5.3 获取未读数量
- **URL**：`GET /message/getUnreadCount`

### 6.6 AI接口 (AIController)

#### 6.6.1 AI生成回复
- **URL**：`GET /ai/generateReply`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| articleId | Long | 是 | 帖子ID |

#### 6.6.2 AI生成摘要
- **URL**：`GET /ai/generateSummary`
- **请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| articleId | Long | 是 | 帖子ID |

### 6.7 响应状态码

| 状态码 | 说明 |
|--------|------|
| 0 | 成功 |
| 1000 | 用户名或密码错误 |
| 1001 | 用户不存在 |
| 1002 | 用户被禁言 |
| 1003 | 未登录 |
| 2000 | 帖子不存在 |
| 2001 | 帖子状态异常 |
| 3000 | 板块不存在 |
| 4000 | 回复不存在 |
| 5000 | 站内信不存在 |
| -1 | 系统错误 |


---

## 七、部署指南

### 7.1 环境要求

| 环境 | 版本要求 |
|------|----------|
| JDK | 1.8（必须） |
| MySQL | 5.7+ |
| Maven | 3.6+ |
| 操作系统 | Linux/Windows |

### 7.2 本地开发环境搭建

#### 7.2.1 数据库初始化
```sql
-- 1. 登录MySQL
mysql -u root -p

-- 2. 执行初始化脚本
source /path/to/forum_db.sql

-- 3. 验证数据库
use forum_db;
show tables;
```

#### 7.2.2 修改配置文件
编辑 `src/main/resources/application-dev.yml`：
```yaml
spring:
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/forum_db?characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai
    username: root
    password: 你的数据库密码
```

#### 7.2.3 配置AI服务（可选）
1. 登录火山引擎控制台：https://console.volcengine.com/
2. 进入"火山方舟" -> "开通管理"
3. 开通豆包模型（如 Doubao-Seed-1.8）
4. 进入"API Key管理"，创建API Key
5. 修改配置文件：
```yaml
ai:
  enabled: true
  api-key: 你的API Key
  api-url: https://ark.cn-beijing.volces.com/api/v3/chat/completions
```

#### 7.2.4 启动项目
```bash
# 方式一：使用Maven命令
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# 方式二：使用IDE
# 直接运行 ForumApplication.java 的 main 方法
```

#### 7.2.5 访问系统
- 前台首页：http://localhost:9090/index.html
- 登录页面：http://localhost:9090/sign-in.html
- 注册页面：http://localhost:9090/sign-up.html
- API文档：http://localhost:9090/swagger-ui/index.html

### 7.3 生产环境部署

#### 7.3.1 打包项目
```bash
# 使用生产环境配置打包
mvn clean package -Pprod -DskipTests

# 打包完成后，jar包位于 target/forum-0.0.1-SNAPSHOT.jar
```

#### 7.3.2 上传到服务器
```bash
# 使用scp上传
scp target/forum-0.0.1-SNAPSHOT.jar root@your-server-ip:/root/java/forum/

# 或使用其他工具如 FileZilla、WinSCP 等
```

#### 7.3.3 服务器环境准备
```bash
# 1. 安装JDK 1.8
yum install java-1.8.0-openjdk java-1.8.0-openjdk-devel -y

# 2. 验证Java版本
java -version

# 3. 安装MySQL（如果没有）
yum install mysql-server -y
systemctl start mysqld
systemctl enable mysqld

# 4. 创建项目目录
mkdir -p /root/java/forum
```

#### 7.3.4 初始化数据库
```bash
# 上传SQL文件
scp src/forum_db.sql root@your-server-ip:/root/java/forum/

# 在服务器上执行
mysql -u root -p < /root/java/forum/forum_db.sql
```

#### 7.3.5 启动服务
```bash
# 进入项目目录
cd /root/java/forum

# 后台启动（推荐）
nohup java -jar forum-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod > forum.log 2>&1 &

# 查看日志
tail -f forum.log

# 查看进程
ps -ef | grep forum
```

#### 7.3.6 停止服务
```bash
# 查找进程ID
ps -ef | grep forum

# 停止进程
kill -9 进程ID
```

#### 7.3.7 配置开机自启（可选）
创建 systemd 服务文件 `/etc/systemd/system/forum.service`：
```ini
[Unit]
Description=Forum Application
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/java/forum
ExecStart=/usr/bin/java -jar forum-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启用服务：
```bash
systemctl daemon-reload
systemctl enable forum
systemctl start forum
systemctl status forum
```

### 7.4 Nginx 反向代理配置（可选）

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:9090;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
        proxy_pass http://127.0.0.1:9090;
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
}
```

---

## 八、常见问题与解决方案

### 8.1 数据库连接问题

**问题**：连接MySQL时报错 `Public Key Retrieval is not allowed`

**解决方案**：在数据库连接URL中添加参数：
```
?useSSL=false&allowPublicKeyRetrieval=true
```

### 8.2 静态资源缓存问题

**问题**：修改HTML/CSS/JS文件后，页面没有更新

**解决方案**：
1. 重启Spring Boot服务
2. 清除浏览器缓存（Ctrl+Shift+R 强制刷新）
3. 开发时可在浏览器开发者工具中禁用缓存

### 8.3 AI功能不可用

**问题**：点击AI回答/AI摘要按钮提示"AI服务暂时不可用"

**排查步骤**：
1. 检查配置文件中 `ai.enabled` 是否为 `true`
2. 检查 `ai.api-key` 是否正确
3. 检查火山引擎账户是否有余额/额度
4. 查看后端日志，确认具体错误信息

### 8.4 登录状态丢失

**问题**：登录后刷新页面变成未登录状态

**可能原因**：
1. Session 过期
2. 浏览器禁用了 Cookie
3. 跨域问题

### 8.5 文件上传失败

**问题**：上传头像时失败

**排查步骤**：
1. 检查文件大小是否超过限制
2. 检查文件格式是否支持（jpg/png/jpeg）
3. 检查上传目录是否有写入权限

### 8.6 端口被占用

**问题**：启动时报错 `Port 9090 is already in use`

**解决方案**：
```bash
# Windows
netstat -ano | findstr 9090
taskkill /F /PID 进程ID

# Linux
lsof -i:9090
kill -9 进程ID

# 或修改配置文件中的端口号
server:
  port: 9091
```

---

## 九、开发规范

### 9.1 代码规范

#### 命名规范
- **类名**：大驼峰命名，如 `UserController`
- **方法名**：小驼峰命名，如 `getUserById`
- **变量名**：小驼峰命名，如 `userName`
- **常量名**：全大写下划线分隔，如 `MAX_PAGE_SIZE`
- **包名**：全小写，如 `com.example.forum`

#### 注释规范
- 类和方法必须有 JavaDoc 注释
- 复杂逻辑需要添加行内注释
- TODO 注释标记待完成功能

### 9.2 Git 提交规范

```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具相关
```

示例：
```
feat: 添加AI智能回复功能
fix: 修复登录状态丢失问题
docs: 更新项目文档
```

### 9.3 数据库规范

- 表名使用 `t_` 前缀
- 字段名使用小驼峰命名
- 必须有 `createTime` 和 `updateTime` 字段
- 使用逻辑删除（`deleteState`）而非物理删除
- 外键关系通过代码维护，不使用数据库外键约束

---

## 十、版本历史

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0.0 | 2025-01 | 初始版本，基础功能 |
| v1.1.0 | 2026-01 | 添加AI智能助手功能 |
| v1.2.0 | 2026-01 | 添加高级搜索、收藏、浏览记录功能 |
| v1.2.1 | 2026-01 | 优化UI界面，修复已知问题 |

---

## 十一、联系方式

如有问题或建议，请通过以下方式联系：

- **项目地址**：[GitHub/Gitee 仓库地址]
- **技术支持**：[邮箱地址]

---

*文档最后更新时间：2026年1月27日*
