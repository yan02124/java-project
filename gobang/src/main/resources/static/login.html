<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å­æ£‹ - ç™»å½•/æ³¨å†Œ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="main-container" id="mainContainer">
    <div class="panel welcome-panel">
        <h2>WELCOME</h2>
        <p>JOIN US!</p>
        <img src="image/login.png" class="avatar" id="avatarImg" />
    </div>
    <div class="panel form-panel">
        <form class="form login-form" id="loginForm">
            <h2>ç™»å½•</h2>
            <!-- ç”¨æˆ·åè¾“å…¥æ¡† -->
            <div style="position: relative; width: 100%; height: 48px; margin-bottom: 16px;">
                <input type="text"
                       id="username"
                       placeholder="ç”¨æˆ·å"
                       required
                       autocomplete="current-username"
                       style="width: 100%; height: 100%; box-sizing: border-box; padding-right: 40px;">
            </div>
            <!-- å¯†ç è¾“å…¥æ¡† -->
            <div style="position: relative; width: 100%; height: 48px; margin-bottom: 16px;">
                <input type="password"
                       id="password"
                       placeholder="å¯†ç "
                       required
                       autocomplete="current-password"
                       style="width: 100%; height: 100%; box-sizing: border-box; padding-right: 40px;">
                <span id="togglePassword"
                      style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 22px; user-select: none;">
                      ğŸ‘ï¸
                </span>
            </div>
            <button type="button" id="submit">ç™»å½•</button>
            <span class="switch" id="toRegister">æ²¡æœ‰è´¦å·ï¼Ÿå»æ³¨å†Œ</span>
        </form>

        <form class="form register-form" id="registerForm">
            <h2>æ³¨å†Œ</h2>
            <!-- ç”¨æˆ·åè¾“å…¥æ¡† -->
            <div style="position: relative; width: 100%; height: 48px; margin-bottom: 16px;">
                <input type="text"
                       id="reg-username"
                       placeholder="ç”¨æˆ·å"
                       required
                       autocomplete="username"
                       style="width: 100%; height: 100%; box-sizing: border-box; padding-right: 40px;">
            </div>
            <!-- å¯†ç è¾“å…¥æ¡† -->
            <div style="position: relative; width: 100%; height: 48px; margin-bottom: 16px;">
                <input type="password"
                       id="reg-password"
                       placeholder="å¯†ç "
                       required
                       autocomplete="new-password"
                       style="width: 100%; height: 100%; box-sizing: border-box; padding-right: 40px;">
                <span id="toggleRegPassword"
                      style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 22px; user-select: none;">
                      ğŸ‘ï¸
                </span>
            </div>
            <!-- ç¡®è®¤å¯†ç è¾“å…¥æ¡† -->
            <div style="position: relative; width: 100%; height: 48px; margin-bottom: 16px;">
                <input type="password"
                       id="reg-confirm-password"
                       placeholder="ç¡®è®¤å¯†ç "
                       required
                       autocomplete="new-password"
                       style="width: 100%; height: 100%; box-sizing: border-box; padding-right: 40px;">
                <span id="toggleRegConfirmPassword"
                      style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 22px; user-select: none;">
                      ğŸ‘ï¸
                </span>
            </div>
            <button type="button" id="reg-submit">æ³¨å†Œ</button>
            <span class="switch" id="toLogin">å·²æœ‰è´¦å·ï¼Ÿå»ç™»å½•</span>
        </form>
    </div>
</div>
<script src="./js/script1.js"></script>
<script src="./js/jquery-3.7.1.min.js"></script>
<script>
    //ç™»å½•
    let usernameInput = document.querySelector("#username");
    let passwordInput = document.querySelector("#password");
    let submitButton = document.querySelector("#submit");
    submitButton.onclick = function() {
        $.ajax({
            type: 'post',
            url: '/login',
            data: {
                username: usernameInput.value,
                password: passwordInput.value,
            },
            success: function(body) {
                console.log("ç™»å½•å“åº”:", body);
                if(body != null && body.userId > 0) {
                    alert("ç™»å½•æˆåŠŸ!");
                    location.assign("/game_hall.html");
                } else {
                    alert("ç™»å½•å¤±è´¥!");
                }
            },
            error: function(xhr, status, error) {
                console.error("ç™»å½•è¯·æ±‚å¤±è´¥:", error);
                alert("ç™»å½•å¤±è´¥!");
            }
        });
    }

    //æ³¨å†Œ
    //1.è·å–è¡¨å•å…ƒç´ 
    document.addEventListener('DOMContentLoaded', function() {
        let regUsernameInput = document.querySelector("#reg-username");
        let regPasswordInput = document.querySelector("#reg-password");
        let regConfirmPasswordInput = document.querySelector("#reg-confirm-password");
        let regSubmitButton = document.querySelector("#reg-submit");

        //2.æ³¨å†ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        regSubmitButton.onclick = function () {
            console.log("ok");
            //3.è¡¨å•éªŒè¯
            if (!regUsernameInput.value || !regPasswordInput.value) {
                alert("ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º!");
                return;
            }
            if (regPasswordInput.value !== regConfirmPasswordInput.value) {
                alert("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´!");
                return;
            }
            //4.å‘é€æ³¨å†Œè¯·æ±‚
            $.ajax({
                type: 'post',
                url: '/register',
                data: {
                    username: regUsernameInput.value,
                    password: regPasswordInput.value,
                },
                success: function (body) {
                    console.log("æ³¨å†Œå“åº”:", body);
                    if (body && body.username) {
                        alert("æ³¨å†ŒæˆåŠŸ!");
                        location.assign("/login.html");
                    } else {
                        alert("æ³¨å†Œå¤±è´¥!ç”¨æˆ·åå¯èƒ½å·²å­˜åœ¨");
                    }
                },
                error: function () {
                    alert("æ³¨å†Œå¤±è´¥!");
                }
            });
        }
    });
    let togglePassword = document.getElementById('togglePassword');
    togglePassword.onclick = function() {
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            togglePassword.textContent = 'ğŸ™ˆ'; // åˆ‡æ¢å›¾æ ‡
        } else {
            passwordInput.type = 'password';
            togglePassword.textContent = 'ğŸ‘ï¸';
        }
    };
    let regPasswordInput = document.getElementById('reg-password');
    let toggleRegPassword = document.getElementById('toggleRegPassword');
    let regConfirmPasswordInput = document.getElementById('reg-confirm-password');
    let toggleRegConfirmPassword = document.getElementById('toggleRegConfirmPassword');

    toggleRegPassword.onclick = function() {
        if (regPasswordInput.type === 'password') {
            regPasswordInput.type = 'text';
            toggleRegPassword.textContent = 'ğŸ™ˆ';
        } else {
            regPasswordInput.type = 'password';
            toggleRegPassword.textContent = 'ğŸ‘ï¸';
        }
    };
    toggleRegConfirmPassword.onclick = function() {
        if (regConfirmPasswordInput.type === 'password') {
            regConfirmPasswordInput.type = 'text';
            toggleRegConfirmPassword.textContent = 'ğŸ™ˆ';
        } else {
            regConfirmPasswordInput.type = 'password';
            toggleRegConfirmPassword.textContent = 'ğŸ‘ï¸';
        }
    };
</script>
</body>
</html>